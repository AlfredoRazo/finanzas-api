<app-nav></app-nav>
<app-user></app-user>
<h3>Recinto</h3>
<hr class="red">
<ul class="nav nav-tabs">
  <li role="presentation" [class.active]="submenu==1"><a [routerLink]="" (click)="submenu=1">Solicitudes de servicio</a>
  </li>
  <li role="presentation" [class.active]="submenu==2"><a [routerLink]="" (click)="submenu=2">CFDI</a></li>
  <li role="presentation" [class.active]="submenu==3"><a [routerLink]="" (click)="submenu=3">Cargar Manifiesto</a></li>
  <li role="presentation" [class.active]="submenu==4"><a [routerLink]="" (click)="submenu=4">I3</a></li>
  <li role="presentation" [class.active]="submenu==5"><a [routerLink]="" (click)="submenu=5">Consultas</a></li>
  <li role="presentation" [class.active]="submenu==6"><a [routerLink]="" (click)="submenu=6">Personal de recinto</a>
  </li>
  <li role="presentation" [class.active]="submenu==7"><a [routerLink]="" (click)="submenu=7">Consulta de manifiesto</a>
  </li>
</ul>
<br>
<br>
<container-element [ngSwitch]="submenu">

  <div *ngSwitchCase="1">
    <form class="form-horizontal">
      <div class="form-group">
        <label class="col-sm-2 control-label" style="text-align: left !important;">Filtrar por: </label>
        <div class="col-sm-3">
          <select class="form-control">
            <option>Opciones</option>
          </select>
        </div>
        <div class="col-sm-5">
          <input type="email" class="form-control" placeholder="Criterio">
        </div>
        <div class="col-sm-2">
          <button class="btn btn-danger btn-block btn-sm" type="button">Buscar <span class="glyphicon glyphicon-search"
              aria-hidden="true"></span></button>
        </div>
      </div>
    </form>
    <br>
    <button type="button" class="btn btn-primary btn-sm" routerLink="nueva-solicitud">Nueva solicitud</button>
    <button class="btn btn-primary btn-sm pull-right" (click)="autorizar()">Autorizar</button>
    <br>
    <br>
    <div class="table-responsive" style="max-height: 500px;">
      <table class="table table-bordered">
        <thead style="white-space: nowrap;">
          <tr style="cursor: pointer;">
            <th></th>
            <th></th>
            <th scope="col" [appSort]="data" data-order="desc" data-name="estatus">Estatus <span
                class="glyphicon glyphicon-sort"></span></th>
            <th scope="col" [appSort]="data" data-order="desc" data-name="idTipoSolicitud">Tipo Solicitud<span
                class="glyphicon glyphicon-sort"></span></th>
            <th scope="col" [appSort]="data" data-order="desc" data-name="fechaServicio">Fecha Servicio<span
                class="glyphicon glyphicon-sort"></span></th>
            <th scope="col" [appSort]="data" data-order="desc" data-name="nombre">Nombre <span
                class="glyphicon glyphicon-sort"></span></th>
            <th scope="col" [appSort]="data" data-order="desc" data-name="idBl">BL <span
                class="glyphicon glyphicon-sort"></span></th>

          </tr>
        </thead>
        <tbody style="white-space: nowrap;">
          <tr *ngFor="let item of data">
            <td style="vertical-align: middle;">
              <ng-container *ngIf="item.estatus == 1">
                <input type="checkbox" [(ngModel)]="item.selected">
              </ng-container>
            </td>
            <td><button class="btn btn-xs btn-primary" (click)="visualizar(item)" data-toggle="modal"
                data-target="#show-data">Revisar detalle</button></td>
            <td>{{item.estatus == '1' ? 'Por Autorizar' : item.estatus == '100' ?'Autorizado': 'Por Definir' }}</td>
            <td>{{getTipoSolicitud(item.idTipoSolicitud)}}</td>
            <td>{{item.fechaServicio}}</td>
            <td>{{item.nombre}}</td>
            <td>{{item.numBL}}</td>
          </tr>
        </tbody>
      </table>
    </div>
    <p>Registros encontrados: <b>{{total}}</b></p>
    <ngb-pagination [collectionSize]="total" [pageSize]="collSize" [(page)]="page" (pageChange)="paginado($event)"
      [maxSize]="3" [rotate]="true" [boundaryLinks]="true"></ngb-pagination><br>
  </div>
  <div *ngSwitchCase="2">
    <app-cfdi></app-cfdi>
  </div>
  <div [hidden]="submenu!=3">
    <app-carga-manifiesto></app-carga-manifiesto>
  </div>
  <div *ngSwitchCase="4"></div>
  <div *ngSwitchCase="5">
    <app-pagos-table [parent]="'recinto'"></app-pagos-table>
  </div>
  <div *ngSwitchCase="6">
    <app-personal-recinto></app-personal-recinto>
  </div>
  <div *ngSwitchCase="7">
    <div class="row">
      <div class="form-group col-md-4">
        <label class="control-label">Manifiesto</label>
        <input type="text" class="form-control" name="manifiesto" [(ngModel)]="manifiesto">
      </div>
      <div class="col-md-8">
        <button class="btn btn-primary btn-sm" style="margin-top: 30px;" (click)="consultarManifiesto()"
          [disabled]="!manifiesto">Buscar</button>

      </div>
    </div>
    <div *ngIf="manifiestoData">
      <div class="row">
        <div class="form-group col-md-4">
          <label class="control-label">Manifiesto</label>
          <input type="text" class="form-control" readonly [(ngModel)]="manifiestoData.nuManifiesto">
        </div>
        <div class="form-group col-md-4">
          <label class="control-label">Buque</label>
          <input type="text" class="form-control" readonly [(ngModel)]="manifiestoData.buque">
        </div>
        <div class="form-group col-md-4">
          <label class="control-label">Viaje</label>
          <input type="text" class="form-control" readonly [(ngModel)]="manifiestoData.viaje">
        </div>
      </div>
      <div class="row">
        <div class="form-group col-md-4">
          <label class="control-label">Fecha Entrada</label>
          <input type="text" class="form-control" readonly [(ngModel)]="manifiestoData.fechaEntradaSalida">
        </div>
      </div>
      <div class="table-responsive" style="font-size: 0.65em; max-height: 500px;">
        <table class="table table-striped table-bordered" style="white-space: nowrap;">
          <thead>
            <tr style="cursor: pointer;">
              <th>BL</th>
              <th>Embarcador</th>
              <th>Consignatario</th>
              <th>Notificar a</th>
              <th>Marcas y Números</th>
              <th>Cantidad</th>
              <th>Unidad</th>
              <th>Descripción</th>
              <th>Peso Bruto</th>
              <th>Volumen</th>
              <th>Puerto Carga</th>
              <th>Puerto Origen</th>
              <th>Puerto Descarga</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let item of manifiestoData?.bls">
              <td>{{item.bl}}</td>
              <td>{{item.embarcador}}</td>
              <td>{{item.consignatario}}</td>
              <td>{{item.notificarA}}</td>
              <td>{{item.marcasNumeros}}</td>
              <td>{{item.cantidad}}</td>
              <td>{{item.unidad}}</td>
              <td>{{item.descripcion}}</td>
              <td>{{item.pesoBruto}}</td>
              <td>{{item.volumen}}</td>
              <td>{{item.puertoEmbarque}}</td>
              <td>{{item.puertoEmision}}</td>
              <td>{{item.puertoDescarga}}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</container-element>
<br>
<br>
<br>
<button type="button" class="btn btn-default" routerLink="/main">Regresar</button>


<div class="modal fade" id="show-data">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">Visualizar</h4>
      </div>
      <div class="modal-body">
        <h4>Solicitud</h4>
        <hr class="red">
        <table class="table table-bordered table-striped">
          <tbody>
            <tr>
              <td>Tipo Servicio</td>
              <td>{{visualSolicitud?.idTipoServicio == 1 ? 'Contenedores':'Carga suelta'}}</td>
            </tr>
            <tr>
              <td>Tipo Trámite</td>
              <td>{{getTipoTramite(visualSolicitud?.idTipoTramite)}}</td>
            </tr>
            <tr>
              <td>Tipo Solicitud</td>
              <td>{{getTipoSolicitud(visualSolicitud?.idTipoSolicitud)}}</td>
            </tr>
            <tr>
              <td>Tipo Transporte</td>
              <td>{{getTipoTransporte(visualSolicitud?.idTipoTransporte)}}</td>
            </tr>
            <tr>
              <td>Fecha Servicio</td>
              <td>{{visualSolicitud?.fechaServicio}}</td>
            </tr>
            <tr>
              <td>Patente</td>
              <td>{{visualSolicitud?.patente}}</td>
            </tr>
            <tr>
              <td>Buque</td>
              <td>{{visualSolicitud?.buque}}</td>
            </tr>
            <tr>
              <td>Nombre</td>
              <td>{{visualSolicitud?.nombre}}</td>
            </tr>
            <tr>
              <td>Fecha Arribo</td>
              <td>{{visualSolicitud?.fechaArribo}}</td>
            </tr>
            <tr>
              <td>Fecha Inicio de Operaciones</td>
              <td>{{visualSolicitud?.fechaIniOperaciones}}</td>
            </tr>
            <tr>
              <td>Viaje</td>
              <td>{{visualSolicitud?.viaje}}</td>
            </tr>
            <tr>
              <td>Fecha Zarpe</td>
              <td>{{visualSolicitud?.fechaZarpe}}</td>
            </tr>

          </tbody>
        </table>
        <h4>B/L</h4>
        <hr class="red">
        <table class="table table-bordered table-striped">
          <tbody>
            <tr>
              <td>B/L</td>
              <td>{{visualBL?.bl}}</td>
            </tr>
            <tr>
              <td>Embarcador</td>
              <td>{{visualBL?.embarcador}}</td>
            </tr>
            <tr>
              <td>Consignatario</td>
              <td>{{visualBL?.consignatario}}</td>
            </tr>
            <tr>
              <td>Notificar</td>
              <td>{{visualBL?.notificarA}}</td>
            </tr>
            <tr>
              <td>Marcas y números</td>
              <td>{{visualBL?.marcasNumeros}}</td>
            </tr>
            <tr>
              <td>Cantidad</td>
              <td>{{visualBL?.cantidad}}</td>
            </tr>
            <tr>
              <td>Unidad</td>
              <td>{{visualBL?.unidad}}</td>
            </tr>
            <tr>
              <td>Descripción</td>
              <td>{{visualBL?.descripcion}}</td>
            </tr>
            <tr>
              <td>Peso Bruto</td>
              <td>{{visualBL?.pesoBruto}}</td>
            </tr>
            <tr>
              <td>Volumen</td>
              <td>{{visualBL?.volumen}}</td>
            </tr>
          </tbody>
        </table>
        <div class="table-responsive" style="font-size: 0.65em; max-height: 500px;" *ngIf="blmovimiento.length > 0">
          <table class="table table-bordered table-striped">
              <thead>
                  <tr style="cursor: pointer">
                      <th style="white-space: nowrap;" scope="col" [appSort]="blmovimiento" data-order="desc"
                          data-name="bl">BL <span class="glyphicon glyphicon-sort"></span></th>
                      <th style="white-space: nowrap;" scope="col" [appSort]="blmovimiento" data-order="desc"
                          data-name="embarcador">Embarcador <span class="glyphicon glyphicon-sort"></span></th>
                      <th style="white-space: nowrap;" scope="col" [appSort]="blmovimiento" data-order="desc"
                          data-name="consignatario">Consignatario
                          <span class="glyphicon glyphicon-sort"></span>
                      </th>
                      <th style="white-space: nowrap;" scope="col" [appSort]="blmovimiento" data-order="desc"
                          data-name="notificarA">Notificar a <span class="glyphicon glyphicon-sort"></span></th>
                      <th style="white-space: nowrap;" scope="col" [appSort]="blmovimiento" data-order="desc"
                          data-name="marcasNumeros">Marcas y Números
                          <span class="glyphicon glyphicon-sort"></span>
                      </th>
                      <th style="white-space: nowrap;" scope="col" [appSort]="blmovimiento" data-order="desc"
                          data-name="cantidad">Cantidad <span class="glyphicon glyphicon-sort"></span></th>
                      <th style="white-space: nowrap;" scope="col" [appSort]="blmovimiento" data-order="desc"
                          data-name="unidad">Unidad <span class="glyphicon glyphicon-sort"></span></th>
                      <th style="white-space: nowrap;" scope="col" [appSort]="blmovimiento" data-order="desc"
                          data-name="descripcion">Descripción <span class="glyphicon glyphicon-sort"></span></th>
                      <th style="white-space: nowrap;" scope="col" [appSort]="blmovimiento" data-order="desc"
                          data-name="pesoBruto">Peso Bruto (KG) <span class="glyphicon glyphicon-sort"></span></th>
                      <th style="white-space: nowrap;" scope="col" [appSort]="blmovimiento" data-order="desc"
                          data-name="volumen">Volumen <span class="glyphicon glyphicon-sort"></span></th>
                  </tr>
              </thead>
              <tbody>
                  <tr *ngFor="let item of blmovimiento; let i = index" >
                      <td>{{item.bl}}<br><b>{{item.Tipo}}</b></td>
                      <td>{{item.embarcador}}</td>
                      <td>{{item.consignatario}}</td>
                      <td>{{item.notificarA}}</td>
                      <td>{{item.marcasNumeros}}</td>
                      <td>{{item.movimientoCant}}</td>
                      <td>{{item.unidad}}</td>
                      <td>{{item.descripcion}}</td>
                      <td>{{item.movimientoPeso}}</td>
                      <td>{{item.movimientovolumen}}</td>
                  </tr>      
              </tbody>
          </table>
      </div>
      <ng-container *ngIf="bldocs.length > 0">
        <h4>Movimiento Previo</h4>
        <hr class="red">
        <table class="table table-bordered table-striped">
          <tbody>
          <tr *ngFor="let doc of bldocs">
            <td>{{doc.nombre}}</td>
            <td><a class="btn btn-sm btn-primary" target="_blank" [href]="'https://pis-api-recinto.azurewebsites.net/' + doc.archivo">Descargar</a></td>
          </tr>
          </tbody>
        </table>
      </ng-container>
        <!--ng-container *ngIf="documentosVisual.length > 0">
          <h4>Documentos</h4>
          <hr class="red">
          <table class="table table-bordered table-striped">
            <tbody>
            <tr *ngFor="let doc of documentosVisual">
              <td>{{doc.nombre}}</td>
              <td><button class="btn btn-sm btn-primary">Descargar</button></td>
            </tr>
            </tbody>
          </table>
        </ng-container-->
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->